<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/7/78/Protezione_Civile.svg/1200px-Protezione_Civile.svg.png">
    <title>S.A.R. Unit√† Merlini</title>
    <style>
        :root { --blu: #003366; --giallo: #ffcc00; --rosso: #cc0000; --verde: #28a745; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--blu); color: white; text-align: center; padding: 20px; margin: 0; }
        
        .box { background: white; padding: 30px; border-radius: 25px; max-width: 400px; margin: 40px auto; color: #333; box-shadow: 0 15px 35px rgba(0,0,0,0.4); }
        .header { background: var(--giallo); color: var(--blu); padding: 15px; border-radius: 15px; font-weight: bold; margin-bottom: 25px; font-size: 18px; text-transform: uppercase; }
        
        textarea { width: 100%; height: 120px; padding: 15px; border: 2px solid #eee; border-radius: 12px; box-sizing: border-box; font-size: 16px; margin-bottom: 20px; resize: none; outline: none; }
        
        button { width: 100%; padding: 16px; color: white; border: none; font-weight: bold; border-radius: 12px; cursor: pointer; font-size: 17px; margin-bottom: 15px; transition: 0.3s; }
        .btn-alert { background: var(--rosso); box-shadow: 0 4px 0 #990000; }
        .btn-gps { background: var(--verde); box-shadow: 0 4px 0 #1e7e34; }
        button:active { transform: translateY(4px); box-shadow: none; }

        /* Stile della Finestra Modale */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 51, 102, 0.9); backdrop-filter: blur(5px); }
        .modal-content { background: white; margin: 15% auto; padding: 25px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-top: 8px solid var(--giallo); }
        .modal-content h3 { margin: 0 0 10px 0; color: var(--blu); }
        .modal-desc { font-size: 14px; color: #555; margin-bottom: 5px; line-height: 1.4; }
        .modal-link { display: block; font-size: 12px; color: #007bff; text-decoration: underline; margin-bottom: 15px; word-break: break-all; }
        .modal-input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 18px; text-align: center; outline: none; }
        .modal-btns { display: flex; gap: 10px; margin-top: 15px; }
        .btn-confirm { background: var(--blu); flex: 2; margin-bottom: 0; }
        .btn-cancel { background: #666; flex: 1; margin-bottom: 0; }

        #stato { margin-top: 15px; font-weight: bold; font-size: 14px; color: #777; }
    </style>
</head>
<body>

<div class="box">
    <div class="header">PROTEZIONE CIVILE - LECCO</div>
    <h2 style="margin:0; color: var(--blu);">Unit√† "A. Merlini"</h2>
    <p style="font-size: 14px; color: #666; margin-bottom: 25px;">S.A.R. Operation Center</p>
    
    <textarea id="testo" placeholder="Inserisci dettagli missione..."></textarea>
    
    <button class="btn-alert" onclick="apriModale('allerta')">üö® INVIA ATTIVAZIONE</button>
    <button class="btn-gps" onclick="apriModale('gps')">üõ∞Ô∏è INVIA COORDINATE GPS</button>
    
    <div id="stato">Sistema pronto</div>
</div>

<div id="customModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle">Sicurezza</h3>
        <p id="modalDesc" class="modal-desc">Inserisci il PIN per procedere</p>
        <a id="modalLinkLabel" class="modal-link" href="#" target="_blank" style="display:none;"></a>
        <input type="password" id="modalInput" class="modal-input" placeholder="...">
        <div class="modal-btns">
            <button class="btn-cancel" onclick="chiudiModale()">Annulla</button>
            <button id="modalActionBtn" class="btn-confirm">Conferma</button>
        </div>
    </div>
</div>

<script>
    const TOKEN = "8237203800:AAGzZi2zgPyAa6bCunZkNCzH7hlz5rNykVA";
    const ID_GRUPPO = "-1003709844017";
    const PIN_CORRETTO = "1234";

    function apriModale(tipo) {
        const modal = document.getElementById('customModal');
        const input = document.getElementById('modalInput');
        const title = document.getElementById('modalTitle');
        const desc = document.getElementById('modalDesc');
        const link = document.getElementById('modalLinkLabel');
        const btn = document.getElementById('modalActionBtn');

        // Reset per richiesta PIN
        input.value = "";
        input.type = "password";
        input.placeholder = "PIN di sicurezza";
        title.innerText = "Autorizzazione";
        desc.innerText = "Inserisci il codice per inviare";
        link.style.display = "none";
        
        modal.style.display = "block";
        input.focus();

        btn.onclick = function() {
            if (input.value !== PIN_CORRETTO) {
                alert("PIN Errato!");
                return;
            }
            
            if (tipo === 'allerta') {
                eseguiInvioAllerta();
            } else {
                faseCoordinate();
            }
        };
    }

    function faseCoordinate() {
        const input = document.getElementById('modalInput');
        const title = document.getElementById('modalTitle');
        const desc = document.getElementById('modalDesc');
        const link = document.getElementById('modalLinkLabel');
        const btn = document.getElementById('modalActionBtn');

        input.value = "";
        input.type = "text";
        input.placeholder = "es. 45.85, 9.39";
        title.innerText = "Coordinate GPS";
        desc.innerText = "Qui puoi trovare le coordinate di tutti i luoghi:";
        link.innerText = "gps-longitudine-latitudine.it";
        link.href = "https://www.gps-longitudine-latitudine.it/";
        link.style.display = "block";
        
        btn.onclick = function() {
            if (!input.value.trim()) {
                alert("Inserisci le coordinate!");
                return;
            }
            eseguiInvioGPS(input.value);
        };
    }

    function chiudiModale() {
        document.getElementById('customModal').style.display = "none";
    }

    function eseguiInvioAllerta() {
        const testo = document.getElementById('testo').value;
        if (!testo.trim()) { alert("Scrivi un messaggio!"); return; }
        const msg = "‚ö†Ô∏è *ALLERTA UNIT√Ä MERLINI* ‚ö†Ô∏è\n\n" + testo;
        chiudiModale();
        inviaATelegram(msg);
    }

    function eseguiInvioGPS(coords) {
        const coordsPulite = coords.replace(/\s/g, '');
        const linkMaps = `https://www.google.com/maps/search/?api=1&query=${coordsPulite}`;
        const msg = "üõ∞Ô∏è *POSIZIONE GPS RILEVATA*\nDestinazione intervento:\n\n`" + coords + "`\n\nüìç Apri navigatore:\n" + linkMaps;
        chiudiModale();
        inviaATelegram(msg);
    }

    function inviaATelegram(testo) {
        const displayStato = document.getElementById('stato');
        displayStato.innerText = "‚è≥ Invio in corso...";
        displayStato.style.color = "#003366";

        fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage?chat_id=${ID_GRUPPO}&text=${encodeURIComponent(testo)}&parse_mode=Markdown`)
        .then(res => {
            if(res.ok) {
                displayStato.innerText = "‚úÖ INVIATO CORRETTAMENTE";
                displayStato.style.color = "green";
                document.getElementById('testo').value = "";
            } else {
                displayStato.innerText = "‚ùå ERRORE INVIO";
                displayStato.style.color = "red";
            }
        });
    }

    window.onclick = function(event) {
        const modal = document.getElementById('customModal');
        if (event.target == modal) chiudiModale();
    }
</script>

</body>
</html>
