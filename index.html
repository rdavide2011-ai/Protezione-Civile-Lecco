<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S.A.R. UNIT√Ä MERLINI - PRO</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --bg-dark: #0a1118;
            --panel-bg: #1c222d;
            --pc-yellow: #ffcc00;
            --pc-blue: #0066cc;
            --danger: #d63031;
            --success: #27ae60;
            --text-main: #f0f0f0;
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-main); margin:0; padding:0; }
        
        /* Navbar Navigazione Moduli */
        .module-nav {
            display: flex; background: #000; padding: 10px; gap: 10px;
            overflow-x: auto; border-bottom: 2px solid var(--pc-yellow);
        }
        .nav-btn {
            padding: 8px 15px; background: var(--panel-bg); color: white;
            border: 1px solid #444; border-radius: 5px; font-size: 11px; white-space: nowrap;
        }
        .nav-btn.active { background: var(--pc-yellow); color: black; font-weight: bold; }

        .container { padding: 15px; max-width: 800px; margin: auto; }
        
        /* Sezione Squadre */
        .squadra-box {
            background: var(--panel-bg); border-left: 5px solid var(--pc-blue);
            padding: 15px; margin-bottom: 15px; border-radius: 5px;
        }
        .volontario-tag {
            display: inline-block; background: #34495e; padding: 5px 10px;
            border-radius: 15px; font-size: 12px; margin: 3px; border: 1px solid #555;
        }
        .special-badge { color: var(--pc-yellow); font-weight: bold; font-size: 10px; margin-left: 5px; }

        .btn-action {
            width: 100%; padding: 15px; margin-top: 10px; border: none;
            border-radius: 8px; font-weight: bold; text-transform: uppercase; cursor: pointer;
        }
        
        /* Pannello Allerta con Tasti Risposta */
        .alert-preview {
            border: 2px dashed var(--danger); padding: 15px; border-radius: 10px; margin-bottom: 20px;
        }

        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-dark); z-index: 9999; display: flex; align-items: center; justify-content: center;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div style="text-align: center; width: 80%;">
        <h2 style="color:var(--pc-yellow)">ACCESSO UNIT√Ä MERLINI</h2>
        <input type="password" id="loginInput" style="width:100%; padding:15px; text-align:center; font-size:24px;" placeholder="PIN">
        <button onclick="checkLogin()" class="btn-action" style="background:var(--pc-yellow); color:black;">ENTRA NELLA CONSOLE</button>
    </div>
</div>

<div class="module-nav">
    <button class="nav-btn active" onclick="showModule('allerta')">üö® INVIO ALLERTA</button>
    <button class="nav-btn" onclick="showModule('squadre')">üë• GESTIONE SQUADRE</button>
    <button class="nav-btn" onclick="showModule('anagrafica')">üóÇÔ∏è ANAGRAFICA</button>
</div>

<div class="container">
    
    <div id="mod-allerta">
        <h3 style="color:var(--pc-yellow)">EMISSIONE ALLERTA / PRE-ALLERTA</h3>
        <div class="alert-preview">
            <label style="font-size:10px;">MESSAGGIO CHE RICEVER√Ä IL VOLONTARIO:</label>
            <div id="msg-preview" style="font-family:monospace; font-size:12px; margin-top:10px;">
                [ATTIVAZIONE] - Unit√† Merlini<br>
                Evento: ... <br>
                --------------------------<br>
                Tasti risposta disponibili:<br>
                [PRESENTE] [ASSENTE] [RITARDO]
            </div>
        </div>
        
        <input type="text" id="ev_name" placeholder="NOME EVENTO (es. Ricerca Persona)">
        <select id="ev_type" style="margin-top:10px;">
            <option value="PRE-ALLERTA">PRE-ALLERTA (Monitoraggio)</option>
            <option value="ATTIVAZIONE">ATTIVAZIONE (Emergenza)</option>
        </select>
        <button class="btn-action" style="background:var(--danger); color:white;" onclick="sendAlert()">LANCIA ALLERTA NEL GRUPPO</button>
    </div>

    <div id="mod-squadre" class="hidden">
        <h3 style="color:var(--pc-blue)">COMPOSIZIONE SQUADRE OPERATIVE</h3>
        <div class="squadra-box">
            <h4 style="margin:0">SQUADRA SAR 1</h4>
            <div id="squadra1-list">
                <span class="volontario-tag">G. Rossi <span class="special-badge">Caposquadra</span></span>
                <span class="volontario-tag">M. Bianchi <span class="special-badge">Cinofilo</span></span>
            </div>
            <button style="font-size:10px; background:none; border:1px solid #777; color:#ccc; margin-top:10px;">+ AGGIUNGI VOLONTARIO</button>
        </div>
        
        <button class="btn-action" style="background:var(--pc-blue); color:white;" onclick="generatePDF()">GENERA FOGLIO FIRME (PDF)</button>
    </div>

    <div id="mod-anagrafica" class="hidden">
        <h3 style="color:var(--success)">RICERCA SPECIALISTI</h3>
        <input type="text" placeholder="Cerca per specializzazione (es. Cinofilo, AIB, Autista)...">
        <div style="margin-top:20px;">
            <div class="volontario-tag">Mario Verdi - <span style="color:#27ae60">Cinofilo</span></div>
            <div class="volontario-tag">Luca Neri - <span style="color:#27ae60">Autista Mezzi Speciali</span></div>
            <div class="volontario-tag">Anna Blu - <span style="color:#27ae60">Logistica</span></div>
        </div>
    </div>

</div>

<script>
    const TOKEN = "8237203800:AAGzZi2zgPyAa6bCunZkNCzH7hlz5rNykVA";
    const ID_GRUPPO = "-1003709844017";
    const PIN_CORRETTO = "1234";

    function checkLogin() {
        if(document.getElementById('loginInput').value === PIN_CORRETTO) {
            document.getElementById('loginOverlay').style.display = 'none';
        } else { alert("Accesso Negato"); }
    }

    function showModule(modId) {
        document.getElementById('mod-allerta').classList.add('hidden');
        document.getElementById('mod-squadre').classList.add('hidden');
        document.getElementById('mod-anagrafica').classList.add('hidden');
        document.getElementById('mod-' + modId).classList.remove('hidden');
        
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
    }

    function sendAlert() {
        const name = document.getElementById('ev_name').value;
        const type = document.getElementById('ev_type').value;
        
        // Costruzione messaggio con tastiera inline (Tasti cliccabili su Telegram)
        const msg = `üö® *${type} UNIT√Ä MERLINI*\n\nüìå *Evento:* ${name}\n\nConferma la tua disponibilit√† tramite i tasti sottostanti:`;
        
        const keyboard = {
            inline_keyboard: [
                [
                    { text: "‚úÖ PRESENTE", callback_data: "pres_si" },
                    { text: "‚ùå ASSENTE", callback_data: "pres_no" }
                ],
                [
                    { text: "‚è≥ IN RITARDO", callback_data: "pres_rit" }
                ]
            ]
        };

        const url = `https://api.telegram.org/bot${TOKEN}/sendMessage`;
        fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                chat_id: ID_GRUPPO,
                text: msg,
                parse_mode: 'Markdown',
                reply_markup: keyboard
            })
        }).then(res => alert("Allerta inviata con tasti risposta!"));
    }

    function generatePDF() {
        alert("Generazione PDF in corso... (Questa funzione richiede la libreria jsPDF)");
        // Qui si integrerebbe jsPDF per scaricare il file pre-compilato
    }
</script>
</body>
</html>
