<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/7/78/Protezione_Civile.svg/1200px-Protezione_Civile.svg.png">
    <title>S.A.R. Unit√† Merlini - Protezione Civile Lecco</title>
    <style>
        :root {
            --pc-blue: #003366; /* Blu Istituzionale */
            --pc-yellow: #FFD700; /* Giallo Soccorso */
            --pc-gray: #f4f4f9;
            --pc-dark: #1a1a1a;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--pc-blue);
            color: var(--pc-dark);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* Pannello Centrale */
        .container {
            background: white;
            width: 90%;
            max-width: 450px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        /* Intestazione Formale */
        .header {
            background: var(--pc-yellow);
            padding: 20px;
            text-align: center;
            border-bottom: 4px solid #e6c200;
        }

        .header img {
            width: 60px;
            margin-bottom: 10px;
        }

        .header h1 {
            margin: 0;
            font-size: 16px;
            color: var(--pc-blue);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .content {
            padding: 30px 25px;
            text-align: center;
        }

        .content h2 {
            font-size: 20px;
            margin-bottom: 5px;
            color: var(--pc-blue);
        }

        .content p {
            font-size: 13px;
            color: #666;
            margin-bottom: 25px;
            text-transform: uppercase;
        }

        /* Input Allerta */
        textarea {
            width: 100%;
            height: 110px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 15px;
            margin-bottom: 20px;
            resize: none;
            box-sizing: border-box;
            background: var(--pc-gray);
        }

        /* Bottoni Operativi */
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            font-size: 15px;
            cursor: pointer;
            margin-bottom: 12px;
            transition: background 0.2s;
            text-transform: uppercase;
        }

        .btn-emergency {
            background-color: #d32f2f;
            color: white;
        }

        .btn-emergency:hover { background-color: #b71c1c; }

        .btn-location {
            background-color: var(--pc-blue);
            color: white;
        }

        .btn-location:hover { background-color: #002244; }

        /* Modale Professionale */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background: white;
            margin: 15% auto;
            padding: 30px;
            width: 80%;
            max-width: 350px;
            border-radius: 4px;
            text-align: center;
        }

        .modal-content h3 {
            color: var(--pc-blue);
            margin-top: 0;
            font-size: 18px;
        }

        .modal-info {
            font-size: 13px;
            color: #555;
            margin: 10px 0;
        }

        .modal-link {
            color: #0056b3;
            text-decoration: none;
            font-size: 12px;
            display: block;
            margin-bottom: 15px;
        }

        .input-modal {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
            text-align: center;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-confirm { background: var(--pc-blue); color: white; flex: 1; padding: 10px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-close { background: #eee; color: #333; flex: 1; padding: 10px; border: none; border-radius: 4px; cursor: pointer; }

        #status-bar {
            padding: 10px;
            font-size: 12px;
            color: #999;
            background: #fafafa;
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/78/Protezione_Civile.svg/1200px-Protezione_Civile.svg.png" alt="Logo PC">
        <h1>Protezione Civile Lecco</h1>
    </div>
    
    <div class="content">
        <h2>Unit√† S.A.R. "A. Merlini"</h2>
        <p>Console Operativa Emergenze</p>
        
        <textarea id="testoInput" placeholder="Inserire qui i dettagli del messaggio di attivazione (Luogo, Mezzi richiesti, Orario di ritrovo)..."></textarea>
        
        <button class="btn btn-emergency" onclick="openControlModal('allerta')">Invia Attivazione Unit√†</button>
        <button class="btn btn-location" onclick="openControlModal('gps')">Invia Coordinate Geografiche</button>
    </div>

    <div id="status-bar">Sistema di allertamento pronto.</div>
</div>

<div id="uiModal" class="modal">
    <div class="modal-content">
        <h3 id="uiTitle">Autenticazione</h3>
        <p id="uiDesc" class="modal-info">Inserire il codice PIN per autorizzare l'invio.</p>
        <a id="uiLink" class="modal-link" href="https://www.gps-longitudine-latitudine.it/" target="_blank" style="display:none;">Recupera coordinate (gps-longitudine-latitudine.it)</a>
        
        <input type="password" id="uiInput" class="input-modal">
        
        <div class="modal-footer">
            <button class="btn-close" onclick="closeControlModal()">Annulla</button>
            <button id="uiConfirmBtn" class="btn-confirm">Conferma</button>
        </div>
    </div>
</div>

<script>
    const TOKEN = "8237203800:AAGzZi2zgPyAa6bCunZkNCzH7hlz5rNykVA";
    const ID_GRUPPO = "-1003709844017";
    const PIN_CORRETTO = "1234";

    function openControlModal(tipo) {
        const modal = document.getElementById('uiModal');
        const input = document.getElementById('uiInput');
        const title = document.getElementById('uiTitle');
        const desc = document.getElementById('uiDesc');
        const link = document.getElementById('uiLink');
        const btn = document.getElementById('uiConfirmBtn');

        // Configurazione iniziale per PIN
        input.value = "";
        input.type = "password";
        input.placeholder = "Codice di sicurezza";
        title.innerText = "Autorizzazione";
        desc.innerText = "Inserire il codice PIN ministeriale.";
        link.style.display = "none";
        
        modal.style.display = "block";
        input.focus();

        btn.onclick = function() {
            if (input.value !== PIN_CORRETTO) {
                alert("Codice di sicurezza non valido.");
                return;
            }
            
            if (tipo === 'allerta') {
                sendAlert();
            } else {
                setupGpsPhase();
            }
        };
    }

    function setupGpsPhase() {
        const input = document.getElementById('uiInput');
        const title = document.getElementById('uiTitle');
        const desc = document.getElementById('uiDesc');
        const link = document.getElementById('uiLink');
        const btn = document.getElementById('uiConfirmBtn');

        input.value = "";
        input.type = "text";
        input.placeholder = "es. 45.85, 9.39";
        title.innerText = "Coordinate GPS";
        desc.innerText = "Qui puoi trovare le coordinate di tutti i luoghi:";
        link.style.display = "block";
        
        btn.onclick = function() {
            if (!input.value.trim()) {
                alert("Inserire dati geografici validi.");
                return;
            }
            sendGps(input.value);
        };
    }

    function closeControlModal() {
        document.getElementById('uiModal').style.display = "none";
    }

    function sendAlert() {
        const testo = document.getElementById('testoInput').value;
        if (!testo.trim()) { alert("Campo messaggio vuoto."); return; }
        
        const msg = "‚ö†Ô∏è *ALLERTA UNIT√Ä MERLINI* ‚ö†Ô∏è\n\n" + testo;
        closeControlModal();
        transmit(msg);
    }

    function sendGps(coords) {
        const pulite = coords.replace(/\s/g, '');
        const mapUrl = `https://www.google.com/maps/search/?api=1&query=${pulite}`;
        const msg = "üõ∞Ô∏è *POSIZIONE GPS RILEVATA*\nDestinazione intervento:\n\n`" + coords + "`\n\nüìç Apri navigatore:\n" + mapUrl;
        closeControlModal();
        transmit(msg);
    }

    function transmit(testo) {
        const status = document.getElementById('status-bar');
        status.innerText = "Trasmissione in corso...";
        status.style.color = "#003366";

        fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage?chat_id=${ID_GRUPPO}&text=${encodeURIComponent(testo)}&parse_mode=Markdown`)
        .then(res => {
            if(res.ok) {
                status.innerText = "Trasmissione completata con successo.";
                status.style.color = "green";
                document.getElementById('testoInput').value = "";
            } else {
                status.innerText = "Errore di trasmissione.";
                status.style.color = "red";
            }
        });
    }

    window.onclick = function(event) {
        if (event.target == document.getElementById('uiModal')) closeControlModal();
    }
</script>

</body>
</html>
